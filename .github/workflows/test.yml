name:  Test
on:
  pull_request:
  push:
    branches:
      - main

jobs:
  test:
    runs-on:
      - ubuntu-latest
    steps:
      - name: Cleanup
        uses: AutoModality/action-clean@v1

      - name: "Allow agent-libs repo access, ref: https://github.com/actions/checkout/issues/760"
        run: |
          export GIT_CEILING_DIRECTORIES=/__w
          git config --global --add safe.directory /github/workspace
          git config --global --add safe.directory /__w/clang-format-action-1/clang-format-action-1

      - name: Checkout
        uses: actions/checkout@v3

      - name: Edit test file to need formatting
        run: echo "    " >> testdata/book.proto

      - name: Run this action
        uses: ./

      - name: Check goldens
        run: diff testdata/book.proto testdata/golden/book.proto